(()=>{"use strict";(()=>{function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.file={},this.area=e,this.selectFileInput=this.area.querySelector("#selectFileInput"),this.selectFileButton=this.area.querySelector("#selectFileButton"),this.errorText=this.area.querySelector("#uploadError"),this.selectFileForm=this.area.querySelector(".upload-area__select-file"),this.confirmUploadForm=this.area.querySelector(".upload-area__confirm-upload"),this.confirmUploadFormFileLabel=this.confirmUploadForm.querySelector("#fileName"),this.loadingForm=this.area.querySelector(".upload-area__loading"),this.activeClass="isActive",this.dragEnterClass="upload-area--dragenter",this.init()}var n,i;return n=t,(i=[{key:"init",value:function(){var e=this;this.selectFileInput.addEventListener("change",(function(){return e.selectFileInputHandler()})),this.area.addEventListener("drop",(function(t){return e.dropFileHandler(t)})),this.area.addEventListener("dragenter",(function(t){return e.dragEnterHandler(t)})),this.area.addEventListener("dragover",(function(t){return e.dragOverHandler(t)})),this.area.addEventListener("dragleave",(function(t){return e.dragLeaveHandler(t)}))}},{key:"selectFileInputHandler",value:function(){var e=this.selectFileInput.files[0];e&&"audio/mpeg"===e.type&&this.fileHandler(e)}},{key:"dropFileHandler",value:function(e){this.resetDragAndDropEvents(e),this.area.classList.remove(this.activeClass);var t=e.dataTransfer.files[0];"audio/mpeg"===t.type&&this.fileHandler(t)}},{key:"dragEnterHandler",value:function(e){this.resetDragAndDropEvents(e),this.area.classList.add(this.dragEnterClass)}},{key:"dragOverHandler",value:function(e){this.resetDragAndDropEvents(e)}},{key:"dragLeaveHandler",value:function(e){this.resetDragAndDropEvents(e),this.area.classList.remove(this.dragEnterClass)}},{key:"fileHandler",value:function(e){this.file=e,this.toggleElements(this.selectFileForm,this.confirmUploadForm),this.confirmUploadFormFileLabel.innerText=e.name}},{key:"resetDragAndDropEvents",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"toggleElements",value:function(e,t){e.classList.remove(this.activeClass),t.classList.add(this.activeClass)}},{key:"getFile",value:function(){return this.file}},{key:"setLoading",value:function(){this.toggleElements(this.confirmUploadForm,this.loadingForm),this.errorText.innerHTML=""}},{key:"finishLoading",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.errorText.innerHTML=e?e+"<br/><br/>":"",this.toggleElements(this.loadingForm,this.selectFileForm),this.file={},this.selectFileInput.value=null}}])&&e(n.prototype,i),t}();var n=document.querySelector("#uploadTrack");if(n){var i=new t(n),r=document.querySelector("#musicItemTemplate"),a=document.querySelector("#uploadList"),l=document.querySelector("#uploadedEmpty"),s=document.querySelector("#uploadedTable"),o=function(){a.children.length>1?(l.style.display="none",s.style.display=""):(l.style.display="",s.style.display="none")},d=function e(t){var n=t.currentTarget,i=n.parentNode.parentNode,r=i.dataset.id;r&&fetch("/php/music.php?action=delete&id="+r).then((function(e){return e.json()})).then((function(t){n.removeEventListener("click",e),i.remove(),o()})).catch((function(){}))};document.querySelectorAll("#uploadList .music-item-delete").forEach((function(e){e.addEventListener("click",d)})),document.querySelector("#uploadFileButton").addEventListener("click",(function(){var e=i.getFile();if(console.log(e),e){i.setLoading();var t=new FormData;t.append("file",e,e.name),fetch("/php/music.php?action=upload",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){if(!e)return i.finishLoading("Ошибка загрузки!");if(!0===e.answer){var t=r.cloneNode(!0);a.appendChild(t),t.children[0].innerText=e.name,t.children[1].innerText=e.duration,t.dataset.id=e.id,t.style.display="",t.querySelector(".music-item-delete").addEventListener("click",d),i.finishLoading(),o()}else"size"===e.answer?i.finishLoading("Ошибка! Максимальный размер файла: 8 Мб"):"length"===e.answer?i.finishLoading("Ошибка! Максимальная длина трека: 5 минут"):"invalid"===e.answer?i.finishLoading("Ошибка! Некорректный формат файла!"):i.finishLoading("Ошибка загрузки!")})).catch((function(){i.finishLoading("Ошибка загрузки!")}))}}))}})()})();